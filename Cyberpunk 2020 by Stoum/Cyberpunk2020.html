<div class="main">
    <script type="text/worker">
on("change:move change:body", function() {
    getAttrs(["move", "body"], function(values) {
        console.log(values);
        let mv = values.move*2;

        setAttrs({
            run_max: mv,
            run: mv,
            leap: mv/3,
            save: values.body,
            lift: values.body*40,
            hp_max: values.body*5,
            hp: values.body*5
        })
    });
});

on("clicked:recalc-sp", function(eventInfo){
    console.log(eventInfo);
    getSectionIDs("armor", function(items){
        console.log(items);
        let armor = {head: 0, torso: 0, legs: 0, arms: 0};
        let armorPieces = [];
        items.forEach(function(id){
            let coversAttr = repAttrName("armor", id,"covers");
            let spAttr = repAttrName("armor", id, "sp");
            armorPieces.push(coversAttr, spAttr);
        });

        getAttrs(armorPieces, function(armorValues) {
                for(let i = 0; i < armorPieces.length;){
                    let coversItems = armorValues[armorPieces[i++]].split(",");
                    let sp = armorValues[armorPieces[i++]];
                    coversItems.forEach(function(loc){
                        loc = loc.trim();
                        armor[loc]+=sp*1;
                    });
                }

                setAttrs({
                    head_sp: armor.head,
                    torso_sp: armor.torso,
                    larm_sp: armor.arms,
                    rarm_sp: armor.arms,
                    lleg_sp: armor.legs,
                    rleg_sp: armor.legs
                })
            }
        );
    });
});

on("sheet:opened change:ev_sum change:gear_all_mods change:cyber_all_mods change:ref", function () {
    getAttrs(["ev_sum", "gear_all_mods", "cyber_all_mods", "ref"], function(values){
        let ev_sum = values.ev_sum*-1;
        let gear_mods = JSON.parse(values.gear_all_mods);
        let cyber_mods = JSON.parse(values.cyber_all_mods);

        setAttrs({
            ref_modified: utz(values.ref)*1 + utz(ev_sum) + utz(gear_mods.ref) + utz(cyber_mods.ref)
        })
    })
});

on("sheet:opened change:repeating_weapons", function() {
    TAS.repeating("weapons")
        .fields("weapon_type", "show_burst_auto")
        .each(function(row,attrSet,id,rowSet){
            switch (row.weapon_type) {
                case "P":
                case "SHT":
                case "SNGL": row.show_burst_auto = 0; break;
                case "SMG":
                case "RIF":
                case "AUTO": row.show_burst_auto = 1; break;
            }
        }).execute();
});

on("sheet:opened change:repeating_armor change:repeating_gear change:repeating_cyber change:repeating_weapons", function propagateIds(){
    TAS.repeating("armor")
        .fields("armor_id")
        .each(function(row,attrSet,id,rowSet){
            row.armor_id = id;
        }).execute();

    TAS.repeating("gear")
        .fields("gear_id")
        .each(function(row,attrSet,id,rowSet){
            row.gear_id = id;
        }).execute();

    TAS.repeating("cyber")
        .fields("cyber_id")
        .each(function(row,attrSet,id,rowSet){
            row.cyber_id = id;
        }).execute();

    TAS.repeating("weapons")
        .fields("weapon_id")
        .each(function(row,attrSet,id,rowSet){
            row.weapon_id = id;
        }).execute();
});

on("sheet:opened change:repeating_armor change:repeating_gear change:repeating_cyber remove:repeating_armor remove:repeating_gear remove:repeating_cyber", function calculateMods(){
    TAS.repeatingSimpleSum("armor", "ev", "ev_sum");

    TAS.repeating("gear")
        .attrs("gear_all_mods")
        .fields("gear_mods")
        .reduce(
            function(memo, row, attrSet, id, rowSet) {
                if (!row.gear_mods) {
                    return memo;
                }
                let mods = parseMods(row.gear_mods);
                for(const [mod, value] of Object.entries(mods)){
                    if(!(memo.hasOwnProperty(mod))){
                        memo[mod] = 0;
                    }
                    memo[mod] += value;
                }
                return memo;
            }, {},
            function(memo, rowSet, attrSet){
                console.log(JSON.stringify(memo));
                attrSet.gear_all_mods = JSON.stringify(memo);
            })
        .execute();

    TAS.repeating("cyber")
        .attrs("cyber_all_mods")
        .fields("cyber_mods")
        .reduce(
            function(memo, row, attrSet, id, rowSet) {
                if (!row.cyber_mods) {
                    return memo;
                }
                let mods = parseMods(row.cyber_mods);
                for(const [mod, value] of Object.entries(mods)){
                    if(!(memo.hasOwnProperty(mod))){
                        memo[mod] = 0;
                    }
                    memo[mod] += value;
                }
                return memo;
            }, {},
            function(memo, rowSet, attrSet){
                console.log(JSON.stringify(memo));
                attrSet.cyber_all_mods = JSON.stringify(memo);
            })
        .execute();
});

//undefined to zero
function utz(value) {
    if(value === undefined || isNaN(value)) {
        return 0;
    } else {
        return value;
    }
}

function repAttrName(section, id, attr) {
    return "repeating_"+section+"_"+id+"_"+attr;
}

function parseMods(mods){
    mods = mods.split(",").map(mod => mod.trim());
    let result = {};
    mods.forEach(function(mod){
        mod = mod.split(" ");
        let value = mod[0];
        let attr = mod[1];
        result[attr] = value*1;
    });

    return result;
}

/* ---- BEGIN: TheAaronSheet.js ---- */
// Github:   https://github.com/shdwjk/TheAaronSheet/blob/master/TheAaronSheet.js
// By:       The Aaron, Arcane Scriptomancer
// Contact:  https://app.roll20.net/users/104025/the-aaron

var TAS = TAS || (function(){
    'use strict';

    var version = '0.2.5',
        lastUpdate = 1504710542,

        loggingSettings = {
            debug: {
                key:     'debug',
                title:   'DEBUG',
                color: {
                    bgLabel: '#7732A2',
                    label:   '#F2EF40',
                    bgText:  '#FFFEB7',
                    text:    '#7732A2'
                }
            },
            error: {
                key:     'error',
                title:   'Error',
                color: {
                    bgLabel: '#C11713',
                    label:   'white',
                    bgText:  '#C11713',
                    text:    'white'
                }
            },
            warn: {
                key:     'warn',
                title:   'Warning',
                color: {
                    bgLabel: '#F29140',
                    label:   'white',
                    bgText:  '#FFD8B7',
                    text:    'black'
                }
            },
            info: {
                key:     'info',
                title:   'Info',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            notice: {
                key:     'notice',
                title:   'Notice',
                color: {
                    bgLabel: '#33C133',
                    label:   'white',
                    bgText:  '#ADF1AD',
                    text:    'black'
                }
            },
            log: {
                key:     'log',
                title:   'Log',
                color: {
                    bgLabel: '#f2f240',
                    label:   'black',
                    bgText:  '#ffff90',
                    text:    'black'
                }
            },
            callstack: {
                key:     'TAS',
                title:   'function',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            callstack_async: {
                key:     'TAS',
                title:   'ASYNC CALL',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#413FA9',
                    text:    'white'
                }
            },
            TAS: {
                key:     'TAS',
                title:   'TAS',
                color: {
                    bgLabel: 'grey',
                    label:   'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)',
                    bgText:  'grey',
                    text:    'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)'
                }
            }
        },


        config = {
            debugMode: false,
            logging: {
                log: true,
                notice: true,
                info: true,
                warn: true,
                error: true,
                debug: false
            }
        },

        callstackRegistry = [],
        queuedUpdates = {}, //< Used for delaying saves till the last moment.

        complexType = function(o){
            switch(typeof o){
                case 'string':
                    return 'string';
                case 'boolean':
                    return 'boolean';
                case 'number':
                    return (_.isNaN(o) ? 'NaN' : (o.toString().match(/\./) ? 'decimal' : 'integer'));
                case 'function':
                    return 'function: '+(o.name ? o.name+'()' : '(anonymous)');
                case 'object':
                    return (_.isArray(o) ? 'array' : (_.isArguments(o) ? 'arguments' : ( _.isNull(o) ? 'null' : 'object')));
                default:
                    return typeof o;
            }
        },

        dataLogger = function(primaryLogger,secondaryLogger,data){
            _.each(data,function(m){
                var type = complexType(m);
                switch(type){
                    case 'string':
                        primaryLogger(m);
                        break;
                    case 'undefined':
                    case 'null':
                    case 'NaN':
                        primaryLogger('['+type+']');
                        break;
                    case 'number':
                    case 'not a number':
                    case 'integer':
                    case 'decimal':
                    case 'boolean':
                        primaryLogger('['+type+']: '+m);
                        break;
                    default:
                        primaryLogger('['+type+']:=========================================');
                        secondaryLogger(m);
                        primaryLogger('=========================================================');
                        break;
                }
            });
        },


        colorLog = function(options){
            var coloredLoggerFunction,
                key = options.key,
                label = options.title || 'TAS',
                lBGColor = (options.color && options.color.bgLabel) || 'blue',
                lTxtColor = (options.color && options.color.label) || 'white',
                mBGColor = (options.color && options.color.bgText) || 'blue',
                mTxtColor = (options.color && options.color.text) || 'white';

            coloredLoggerFunction = function(message){
                /* eslint-disable no-console */
                console.log(
                    '%c '+label+': %c '+message + ' ',
                    'background-color: '+lBGColor+';color: '+lTxtColor+'; font-weight:bold;',
                    'background-color: '+mBGColor+';color: '+mTxtColor+';'
                );
                /* eslint-enable no-console */
            };
            return function(){
                if('TAS'===key || config.logging[key]){
                    /* eslint-disable no-console */
                    dataLogger(coloredLoggerFunction,function(m){console.log(m);},_.toArray(arguments));
                    /* eslint-enable no-console */
                }
            };
        },

        logDebug  = colorLog(loggingSettings.debug),
        logError  = colorLog(loggingSettings.error),
        logWarn   = colorLog(loggingSettings.warn),
        logInfo   = colorLog(loggingSettings.info),
        logNotice = colorLog(loggingSettings.notice),
        logLog    = colorLog(loggingSettings.log),
        log       = colorLog(loggingSettings.TAS),
        logCS     = colorLog(loggingSettings.callstack),
        logCSA    = colorLog(loggingSettings.callstack_async),

        registerCallstack = function(callstack,label){
            var idx=_.findIndex(callstackRegistry,function(o){
                return (_.difference(o.stack,callstack).length === _.difference(callstack,o.stack).length) &&
                    _.difference(o.stack,callstack).length === 0 &&
                    o.label === label;
            });
            if(-1 === idx){
                idx=callstackRegistry.length;
                callstackRegistry.push({
                    stack: callstack,
                    label: label
                });
            }
            return idx;
        },

        setConfigOption = function(options){
            var newconf =_.defaults(options,config);
            newconf.logging=_.defaults(
                (options && options.logging)||{},
                config.logging
            );
            config=newconf;
        },

        isDebugMode = function(){
            return config.debugMode;
        },

        debugMode = function(){
            config.logging.debug=true;
            config.debugMode = true;
        },

        getCallstack = function(){
            var e = new Error('dummy'),
                stack = _.map(_.rest(e.stack.replace(/^[^(]+?[\n$]/gm, '')
                    .replace(/^\s+at\s+/gm, '')
                    .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
                    .split('\n')),function(l){
                    return l.replace(/\s+.*$/,'');
                });
            return stack;
        },
        logCallstackSub = function(cs){
            var matches, csa;
            _.find(cs,function(line){
                matches = line.match(/TAS_CALLSTACK_(\d+)/);
                if(matches){
                    csa=callstackRegistry[matches[1]];
                    logCSA( '===================='+(csa.label ? '> '+csa.label+' <' : '')+'====================');
                    logCallstackSub(csa.stack);
                    return true;
                }
                logCS(line);
                return false;
            });
        },
        logCallstack = function(){
            var cs;
            if(config.debugMode){
                cs = getCallstack();
                cs.shift();
                log('==============================> CALLSTACK <==============================');
                logCallstackSub(cs);
                log('=========================================================================');
            }
        },


        wrapCallback = function (label, callback, context){
            var callstack;
            if('function' === typeof label){
                context=callback;
                callback=label;
                label=undefined;
            }
            if(!config.debugMode){
                return (function(cb,ctx){
                    return function(){
                        cb.apply(ctx||{},arguments);
                    };
                }(callback,context));
            }

            callstack = getCallstack();
            callstack.shift();

            return (function(cb,ctx,cs,lbl){
                var ctxref=registerCallstack(cs,lbl);

                /*jshint -W054 */
                return new Function('cb','ctx','TASlog',
                    "return function TAS_CALLSTACK_"+ctxref+"(){"+
                    "var start,end;"+
                    "TASlog('Entering: '+(cb.name||'(anonymous function)'));"+
                    "start=_.now();"+
                    "cb.apply(ctx||{},arguments);"+
                    "end=_.now();"+
                    "TASlog('Exiting: '+(cb.name||'(anonymous function)')+' :: '+(end-start)+'ms elapsed');"+
                    "};")(cb,ctx,log);
                /*jshint +W054 */
            }(callback,context,callstack,label));
        },


        prepareUpdate = function( attribute, value ){
            queuedUpdates[attribute]=value;
        },

        applyQueuedUpdates = function() {
            setAttrs(queuedUpdates);
            queuedUpdates = {};
        },

        namesFromArgs = function(args,base){
            return _.chain(args)
                .reduce(function(memo,attr){
                    if('string' === typeof attr) {
                        memo.push(attr);
                    } else if(_.isArray(args) || _.isArguments(args)){
                        memo = namesFromArgs(attr,memo);
                    }
                    return memo;
                },(_.isArray(base) && base) || [])
                .uniq()
                .value();
        },

        addId = function(obj,value){
            Object.defineProperty(obj,'id',{
                value: value,
                writable: false,
                enumerable: false
            });
        },

        addProp = function(obj,prop,value,fullname){
            (function(){
                var pname=(_.contains(['S','F','I','D'],prop) ? '_'+prop : prop),
                    full_pname = fullname || prop,
                    pvalue=value;

                _.each(['S','I','F'],function(p){
                    if( !_.has(obj,p)){
                        Object.defineProperty(obj, p, {
                            value: {},
                            enumerable: false,
                            readonly: true
                        });
                    }
                });
                if( !_.has(obj,'D')){
                    Object.defineProperty(obj, 'D', {
                        value: _.reduce(_.range(10),function(m,d){
                            Object.defineProperty(m, d, {
                                value: {},
                                enumerable: true,
                                readonly: true
                            });
                            return m;
                        },{}),
                        enumerable: false,
                        readonly: true
                    });
                }


                // Raw value
                Object.defineProperty(obj, pname, {
                    enumerable: true,
                    set: function(v){
                        if(v!==pvalue) {
                            pvalue=v;
                            prepareUpdate(full_pname,v);
                        }
                    },
                    get: function(){
                        return pvalue;
                    }
                });

                // string value
                Object.defineProperty(obj.S, pname, {
                    enumerable: true,
                    set: function(v){
                        var val=v.toString();
                        if(val !== pvalue) {
                            pvalue=val;
                            prepareUpdate(full_pname,val);
                        }
                    },
                    get: function(){
                        return pvalue.toString();
                    }
                });

                // int value
                Object.defineProperty(obj.I, pname, {
                    enumerable: true,
                    set: function(v){
                        var val=parseInt(v,10) || 0;
                        if(val !== pvalue){
                            pvalue=val;
                            prepareUpdate(full_pname,val);
                        }
                    },
                    get: function(){
                        return parseInt(pvalue,10) || 0;
                    }
                });

                // float value
                Object.defineProperty(obj.F, pname, {
                    enumerable: true,
                    set: function(v){
                        var val=parseFloat(v) || 0;
                        if(val !== pvalue) {
                            pvalue=val;
                            prepareUpdate(full_pname,val);
                        }
                    },
                    get: function(){
                        return parseFloat(pvalue) || 0;
                    }
                });
                _.each(_.range(10),function(d){
                    Object.defineProperty(obj.D[d], pname, {
                        enumerable: true,
                        set: function(v){
                            var val=(parseFloat(v) || 0).toFixed(d);
                            if(val !== pvalue){
                                pvalue=val;
                                prepareUpdate(full_pname,val);
                            }
                        },
                        get: function(){
                            return (parseFloat(pvalue) || 0).toFixed(d);
                        }
                    });
                });

            }());
        },

        repeating = function( section ) {
            return (function(s){
                var sectionName = s,
                    attrNames = [],
                    fieldNames = [],
                    operations = [],
                    after = [],

                    repAttrs = function TAS_Repeating_Attrs(){
                        attrNames = namesFromArgs(arguments,attrNames);
                        return this;
                    },
                    repFields = function TAS_Repeating_Fields(){
                        fieldNames = namesFromArgs(arguments,fieldNames);
                        return this;
                    },
                    repReduce = function TAS_Repeating_Reduce(func, initial, final, context) {
                        operations.push({
                            type: 'reduce',
                            func: (func && _.isFunction(func) && func) || _.noop,
                            memo: (_.isUndefined(initial) && 0) || initial,
                            final: (final && _.isFunction(final) && final) || _.noop,
                            context: context || {}
                        });
                        return this;
                    },
                    repMap = function TAS_Repeating_Map(func, final, context) {
                        operations.push({
                            type: 'map',
                            func: (func && _.isFunction(func) && func) || _.noop,
                            final: (final && _.isFunction(final) && final) || _.noop,
                            context: context || {}
                        });
                        return this;
                    },
                    repEach = function TAS_Repeating_Each(func, final, context) {
                        operations.push({
                            type: 'each',
                            func: (func && _.isFunction(func) && func) || _.noop,
                            final: (final && _.isFunction(final) && final) || _.noop,
                            context: context || {}
                        });
                        return this;
                    },
                    repTap = function TAS_Repeating_Tap(final, context) {
                        operations.push({
                            type: 'tap',
                            final: (final && _.isFunction(final) && final) || _.noop,
                            context: context || {}
                        });
                        return this;
                    },
                    repAfter = function TAS_Repeating_After(callback,context) {
                        after.push({
                            callback: (callback && _.isFunction(callback) && callback) || _.noop,
                            context: context || {}
                        });
                        return this;
                    },
                    repExecute = function TAS_Repeating_Execute(callback,context){
                        var rowSet = {},
                            attrSet = {},
                            fieldIds = [],
                            fullFieldNames = [];

                        repAfter(callback,context);

                        // call each operation per row.
                        // call each operation's final
                        getSectionIDs("repeating_"+sectionName,function(ids){
                            fieldIds = ids;
                            fullFieldNames = _.reduce(fieldIds,function(memo,id){
                                return memo.concat(_.map(fieldNames,function(name){
                                    return 'repeating_'+sectionName+'_'+id+'_'+name;
                                }));
                            },[]);
                            getAttrs( _.uniq(attrNames.concat(fullFieldNames)), function(values){
                                _.each(attrNames,function(aname){
                                    if(values.hasOwnProperty(aname)){
                                        addProp(attrSet,aname,values[aname]);
                                    }
                                });

                                rowSet = _.reduce(fieldIds,function(memo,id){
                                    var r={};
                                    addId(r,id);
                                    _.each(fieldNames,function(name){
                                        var fn = 'repeating_'+sectionName+'_'+id+'_'+name;
                                        addProp(r,name,values[fn],fn);
                                    });

                                    memo[id]=r;

                                    return memo;
                                },{});

                                _.each(operations,function(op){
                                    var res;
                                    switch(op.type){
                                        case 'tap':
                                            _.bind(op.final,op.context,rowSet,attrSet)();
                                            break;

                                        case 'each':
                                            _.each(rowSet,function(r){
                                                _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                            });
                                            _.bind(op.final,op.context,rowSet,attrSet)();
                                            break;

                                        case 'map':
                                            res = _.map(rowSet,function(r){
                                                return _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                            });
                                            _.bind(op.final,op.context,res,rowSet,attrSet)();
                                            break;

                                        case 'reduce':
                                            res = op.memo;
                                            _.each(rowSet,function(r){
                                                res = _.bind(op.func,op.context,res,r,attrSet,r.id,rowSet)();
                                            });
                                            _.bind(op.final,op.context,res,rowSet,attrSet)();
                                            break;
                                    }
                                });

                                // finalize attrs
                                applyQueuedUpdates();
                                _.each(after,function(op){
                                    _.bind(op.callback,op.context)();
                                });
                            });
                        });
                    };

                return {
                    attrs: repAttrs,
                    attr: repAttrs,

                    column: repFields,
                    columns: repFields,
                    field: repFields,
                    fields: repFields,

                    reduce: repReduce,
                    inject: repReduce,
                    foldl: repReduce,

                    map: repMap,
                    collect: repMap,

                    each: repEach,
                    forEach: repEach,

                    tap: repTap,
                    'do': repTap,

                    after: repAfter,
                    last: repAfter,
                    done: repAfter,

                    execute: repExecute,
                    go: repExecute,
                    run: repExecute
                };
            }(section));
        },


        repeatingSimpleSum = function(section, field, destination){
            repeating(section)
                .attr(destination)
                .field(field)
                .reduce(function(m,r){
                    return m + (r.F[field]);
                },0,function(t,r,a){
                    a.S[destination]=t;
                })
                .execute();
        };

    /* eslint-disable no-console */
    console.log('%c•.¸¸.•*´¨`*•.¸¸.•*´¨`*•.¸  The Aaron Sheet  v'+version+'  ¸.•*´¨`*•.¸¸.•*´¨`*•.¸¸.•','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
    console.log('%c•.¸¸.•*´¨`*•.¸¸.•*´¨`*•.¸  Last update: '+(new Date(lastUpdate*1000))+'  ¸.•*´¨`*•.¸¸.•*´¨`*•.¸¸.•','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
    /* eslint-enable no-console */


    return {
        /* Repeating Sections */
        repeatingSimpleSum: repeatingSimpleSum,
        repeating: repeating,

        /* Configuration */
        config: setConfigOption,

        /* Debugging */
        callback: wrapCallback,
        callstack: logCallstack,
        debugMode: debugMode,
        isDebugMode: isDebugMode,
        _fn: wrapCallback,

        /* Logging */
        debug: logDebug,
        error: logError,
        warn: logWarn,
        info: logInfo,
        notice: logNotice,
        log: logLog
    };
}());

/* ---- END: TheAaronSheet.js ---- */
</script>
    <div class="header-section">
        <div class="logo section">
            <h1>Cyberpunk RED</h1>
        </div>

        <div class="info section">
            <span>Handle</span> <input name="attr_character_handle" type="text"/>
            <span>Role</span> <input name="attr_role" type="text"/>
            <span>CP</span> <input name="attr_character_points" type="number"/>
            <span>Age</span> <input type="number" name="attr_age"/>
            <span>Gen. IP</span><input name="attr_general_ip" type="number"/>
            <span>Rep</span><input name="attr_reputation" type="number"/>
        </div>
    </div>

    <div class="tabs" style="position: relative">
        <input type="radio" name="attr_tab" title="Stats & Equip" style="grid-area: tab-input"
               class="tab stats-and-equip-tab" value="1" checked="checked">
        <input type="radio" name="attr_tab" title="Skills" style="grid-area: tab-input" class="tab skills-tab"
               value="2">
        <input type="radio" name="attr_tab" title="Gear" style="grid-area: tab-input" class="tab gear-tab" value="3">
        <input type="radio" name="attr_tab" title="Lifepath" style="grid-area: tab-input" class="tab life-path-tab"
               value="4">

        <div class="tab-content stats-and-equip-tab">
            <div class="stats-section section">
                <div class="stats">
                    <span>INT</span>
                    <div><input name="attr_int" type="number"/></div>
                    <span>REF</span>
                    <div>
                        <input name="attr_ref_mod" hidden/>
                        <input name="attr_ref_modified" type="number" class="merge-input-right"/>
                        <input name="attr_ref" type="number" class="merge-input-left"/>
                    </div>
                    <span>DEX</span>
                    <div><input name="attr_dex" type="number"/></div>
                    <span>TECH</span>
                    <div><input name="attr_tech" type="number"/></div>
                    <span>HP</span>
                    <div><input name="attr_hp" type="number" class="merge-input-right"/><input name="attr_hp_max"
                                                                                               type="number"
                                                                                               class="merge-input-left"
                                                                                               readonly/></div>
                    <span>COOL</span>
                    <div><input name="attr_cool" type="number"/></div>
                    <span>WILL</span>
                    <div><input name="attr_will" type="number"/></div>
                    <span>LUCK</span>
                    <div><input name="attr_luck" type="number" class="merge-input-right"/><input name="attr_luck_max"
                                                                                                 type="number"
                                                                                                 class="merge-input-left"/>
                    </div>
                    <span>MOVE</span>
                    <div><input name="attr_move" type="number"/></div>
                    <span>WOUND</span>
                    <div><input name="attr_wound" type="number"/></div>
                    <span>BODY</span>
                    <div><input name="attr_body" type="number"/></div>
                    <span>EMP</span>
                    <div><input name="attr_emp" type="number" class="merge-input-right"/><input
                            name="attr_emp_max" type="number" class="merge-input-left"/></div>
                    <span>Run</span>
                    <div><input name="attr_run" type="number" class="merge-input-right"/><input name="attr_run_max"
                                                                                                type="number"
                                                                                                class="merge-input-left"
                                                                                                readonly/>
                    </div>
                    <span>Leap</span>
                    <div><input name="attr_leap" type="number" readonly/></div>
                    <button type="roll" value="/roll 1d10<@{save}" class="roll-btn">DEATH SAVE</button>
                    <div><input name="attr_save" type="number" readonly/></div>
                </div>
                <div class="hitbox">
                    <table class="hitbox-table">
                        <tr class="hitbox-table">
                            <td class="hitbox-table">Location</td>
                            <td class="hitbox-table">Head</td>
                            <td class="hitbox-table">Torso</td>
                            <td class="hitbox-table">R. Arm</td>
                            <td class="hitbox-table">L. Arm</td>
                            <td class="hitbox-table">R. Leg</td>
                            <td class="hitbox-table">L. Leg</td>
                        </tr>
                        <tr class="hitbox-table">
                            <td class="hitbox-table">
                                <button type="action" name="act_recalc-sp" class="armor-sp">Armor SP</button>
                            </td>
                            <td class="hitbox-table"><input name="attr_head_sp" type="number"/></td>
                            <td class="hitbox-table"><input name="attr_torso_sp" type="number"/></td>
                            <td class="hitbox-table"><input name="attr_rarm_sp" type="number"/></td>
                            <td class="hitbox-table"><input name="attr_larm_sp" type="number"/></td>
                            <td class="hitbox-table"><input name="attr_rleg_sp" type="number"/></td>
                            <td class="hitbox-table"><input name="attr_lleg_sp" type="number"/></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="armor section">
                <span>Armor</span>
                <input hidden name="attr_ev_sum"/>
                <div class="armor-row">
                    <fieldset class="repeating_armor">
                        <input hidden name="attr_armor_id">
                        <input class="options-flag" type="checkbox" name="attr_options-flag">
                        <div class="display">
                            <input type="checkbox" name="attr_equiped"/>
                            <input type="text" name="attr_armor_label" placeholder="Label"/>
                            <input type="number" name="attr_sp" placeholder="SP"/>
                        </div>
                        <div class="options">
                            <input type="checkbox" style="opacity:0" disabled="">
                            <input type="text" name="attr_covers" placeholder="Covers"/>
                            <input type="number" name="attr_ev" placeholder="EV"/>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="weapon section">
                <span>Weapons</span>
                <div>
                    <fieldset class="repeating_weapons">
                        <input class="options-flag" type="checkbox" name="attr_options-flag">
                        <input hidden name="attr_weapon_id">
                        <div class="display">
                            <input type="text" name="attr_weapon_name" placeholder="Name" style="width: 100px;"/>
                            <!--<input type="text" name="attr_weapon_type" placeholder="Type" style="width: 50px"/>-->
                            <select name="attr_weapon_type" placeholder="Type" style="width: 70px">
                                <option value="P">Pistol</option>
                                <option value="SMG">SMG</option>
                                <option value="RIF">Rifle</option>
                                <option value="SHT">Shotgun</option>
                                <option value="SNGL">Single</option>
                                <option value="AUTO">Auto</option>
                            </select>
                            <input type="number" name="attr_weapon_accuracy" placeholder="WA"/>
                            <input type="text" name="attr_weapon_damage" placeholder="Damage" style="width: 60px;"/>
                            <input type="number" name="attr_weapon_shots" placeholder="#SHOTS" style="width: 60px;"/>
                            <button name="roll_single_shot" type="roll" class="single-shot"
                                    value="!shoot!!@{character_name}!!@{weapon_id}!!@{weapon_name}!!single">
                            </button>
                            <input type="radio" style="display:none;" name="attr_show_burst_auto" class="hide-burst-auto" value="0" checked/>
                            <input type="radio" style="display:none;" name="attr_show_burst_auto" class="show-burst-auto" value="1"/>
                            <button name="roll_burst" type="roll" class="burst"
                                    value="!shoot!!@{character_name}!!@{weapon_id}!!@{weapon_name}!!burst">
                            </button>
                            <button name="roll_auto_fire" type="roll" class="auto-fire"
                                    value="!shoot!!@{character_name}!!@{weapon_id}!!@{weapon_name}!!auto!!?{Number of targets}!!?{Range}!!@{weapon_rof}!!?{Hit number}">
                            </button>
                        </div>
                        <div class="options">
                            <input type="text" name="attr_weapon_concealability" placeholder="CON"
                                   style="width: 40px;"/>
                            <input type="text" name="attr_weapon_availability" placeholder="AV" style="width: 40px;"/>
                            <input type="text" name="attr_weapon_ammo" placeholder="ammo" style="width: 40px;"/>
                            <input type="number" name="attr_weapon_clip_size" placeholder="Clip"/>
                            <input type="number" name="attr_weapon_rof" placeholder="ROF"/>
                            <input type="text" name="attr_weapon_reliability" placeholder="REL" style="width: 40px;"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="tab-content skills-tab">
            <div class="skills section">
                <div class="skills-table-column">
                    <div class="skill-row header">
                        <div>Skill name</div>
                        <div>Level</div>
                        <div>IP</div>
                    </div>
                    <div class="skill-row" style="font-weight: bolder;">ABILITIES</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Authority Check}} {{Check=[[1d10 + @{cool} + @{Authority}]]}}' class='roll-btn'>Authority</button></div><div><input type='number' class='skill-input' name='attr_Authority'/></div><div><input type='number' class='skill-ip' name='attr_Authority_ip'></div><input type='hidden' name='attr_Authority_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Charismatic Leadership Check}} {{Check=[[1d10 + @{cool} + @{CharismaticLeadership}]]}}' class='roll-btn'>CharismaticLeadership</button></div><div><input type='number' class='skill-input' name='attr_CharismaticLeadership'/></div><div><input type='number' class='skill-ip' name='attr_CharismaticLeadership_ip'></div><input type='hidden' name='attr_CharismaticLeadership_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Combat Sense Check}} {{Check=[[1d10 + @{ref_modified} + @{CombatSense}]]}}' class='roll-btn'>Combat Sense</button></div><div><input type='number' class='skill-input' name='attr_CombatSense'/></div><div><input type='number' class='skill-ip' name='attr_CombatSense_ip'></div><input type='hidden' name='attr_CombatSense_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Credibility Check}} {{Check=[[1d10 + @{int} + @{Credibility}]]}}' class='roll-btn'>Credibility</button></div><div><input type='number' class='skill-input' name='attr_Credibility'/></div><div><input type='number' class='skill-ip' name='attr_Credibility_ip'></div><input type='hidden' name='attr_Credibility_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Family Check}} {{Check=[[1d10 + @{int} + @{Family}]]}}' class='roll-btn'>Family</button></div><div><input type='number' class='skill-input' name='attr_Family'/></div><div><input type='number' class='skill-ip' name='attr_Family_ip'></div><input type='hidden' name='attr_Family_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Interface Check}} {{Check=[[1d10 + @{int} + @{Interface}]]}}' class='roll-btn'>Interface</button></div><div><input type='number' class='skill-input' name='attr_Interface'/></div><div><input type='number' class='skill-ip' name='attr_Interface_ip'></div><input type='hidden' name='attr_Interface_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Jury Rig Check}} {{Check=[[@{JuryRig}d6]]}}' class='roll-btn'>Jury Rig</button></div><div><input type='number' class='skill-input' name='attr_JuryRig'/></div><div><input type='number' class='skill-ip' name='attr_JuryRig_ip'></div><input type='hidden' name='attr_JuryRig_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Medical Tech Check}} {{Check=[[1d10 + @{int} + @{MedicalTech}]]}}' class='roll-btn'>Medical Tech</button></div><div><input type='number' class='skill-input' name='attr_MedicalTech'/></div><div><input type='number' class='skill-ip' name='attr_MedicalTech_ip'></div><input type='hidden' name='attr_MedicalTech_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Resources Check}} {{Check=[[1d10 + @{int} + @{Resources}]]}}' class='roll-btn'>Resources</button></div><div><input type='number' class='skill-input' name='attr_Resources'/></div><div><input type='number' class='skill-ip' name='attr_Resources_ip'></div><input type='hidden' name='attr_Resources_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Streetdeal Check}} {{Check=[[1d10 + @{cool} + @{Streetdeal}]]}}' class='roll-btn'>Streetdeal</button></div><div><input type='number' class='skill-input' name='attr_Streetdeal'/></div><div><input type='number' class='skill-ip' name='attr_Streetdeal_ip'></div><input type='hidden' name='attr_Streetdeal_uses'></div>
                </div>
                <div class="skills-table-column">
                    <div class="skill-row header">
                        <div>Skill name</div>
                        <div>Level</div>
                        <div>IP</div>
                    </div>
                    <div class="skill-row" style="font-weight: bold;">INT</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Perception Check}} {{Check=[[1d10 + @{int} + @{Perception}]]}}' class='roll-btn'>Perception</button></div><div><input type='number' class='skill-input' name='attr_Perception'/></div><div><input type='number' class='skill-ip' name='attr_Perception_ip'></div><input type='hidden' name='attr_Perception_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Tracking Check}} {{Check=[[1d10 + @{int} + @{Tracking}]]}}' class='roll-btn'>Tracking</button></div><div><input type='number' class='skill-input' name='attr_Tracking'/></div><div><input type='number' class='skill-ip' name='attr_Tracking_ip'></div><input type='hidden' name='attr_Tracking_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Education Check}} {{Check=[[1d10 + @{int} + @{Education}]]}}' class='roll-btn'>Education</button></div><div><input type='number' class='skill-input' name='attr_Education'/></div><div><input type='number' class='skill-ip' name='attr_Education_ip'></div><input type='hidden' name='attr_Education_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=LocalExpert Check}} {{Check=[[1d10 + @{int} + @{LocalExpert}]]}}' class='roll-btn'>LocalExpert</button></div><div><input type='number' class='skill-input' name='attr_LocalExpert'/></div><div><input type='number' class='skill-ip' name='attr_LocalExpert_ip'></div><input type='hidden' name='attr_LocalExpert_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=DiagnoseIllness Check}} {{Check=[[1d10 + @{int} + @{DiagnoseIllness}]]}}' class='roll-btn'>DiagnoseIllness</button></div><div><input type='number' class='skill-input' name='attr_DiagnoseIllness'/></div><div><input type='number' class='skill-ip' name='attr_DiagnoseIllness_ip'></div><input type='hidden' name='attr_DiagnoseIllness_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Gamble Check}} {{Check=[[1d10 + @{int} + @{Gamble}]]}}' class='roll-btn'>Gamble</button></div><div><input type='number' class='skill-input' name='attr_Gamble'/></div><div><input type='number' class='skill-ip' name='attr_Gamble_ip'></div><input type='hidden' name='attr_Gamble_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=HideEvade Check}} {{Check=[[1d10 + @{int} + @{HideEvade}]]}}' class='roll-btn'>HideEvade</button></div><div><input type='number' class='skill-input' name='attr_HideEvade'/></div><div><input type='number' class='skill-ip' name='attr_HideEvade_ip'></div><input type='hidden' name='attr_HideEvade_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Language Check}} {{Check=[[1d10 + @{int} + @{Language}]]}}' class='roll-btn'>Language</button></div><div><input type='number' class='skill-input' name='attr_Language'/></div><div><input type='number' class='skill-ip' name='attr_Language_ip'></div><input type='hidden' name='attr_Language_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Programming Check}} {{Check=[[1d10 + @{int} + @{Programming}]]}}' class='roll-btn'>Programming</button></div><div><input type='number' class='skill-input' name='attr_Programming'/></div><div><input type='number' class='skill-ip' name='attr_Programming_ip'></div><input type='hidden' name='attr_Programming_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=SystemKnowledge Check}} {{Check=[[1d10 + @{int} + @{SystemKnowledge}]]}}' class='roll-btn'>SystemKnowledge</button></div><div><input type='number' class='skill-input' name='attr_SystemKnowledge'/></div><div><input type='number' class='skill-ip' name='attr_SystemKnowledge_ip'></div><input type='hidden' name='attr_SystemKnowledge_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=WildernessSurvival Check}} {{Check=[[1d10 + @{int} + @{WildernessSurvival}]]}}' class='roll-btn'>WildernessSurvival</button></div><div><input type='number' class='skill-input' name='attr_WildernessSurvival'/></div><div><input type='number' class='skill-ip' name='attr_WildernessSurvival_ip'></div><input type='hidden' name='attr_WildernessSurvival_uses'></div>
                    <div class="skill-row" style="font-weight: bold;">COOL</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Bribery Check}} {{Check=[[1d10 + @{cool} + @{Bribery}]]}}' class='roll-btn'>Bribery</button></div><div><input type='number' class='skill-input' name='attr_Bribery'/></div><div><input type='number' class='skill-ip' name='attr_Bribery_ip'></div><input type='hidden' name='attr_Bribery_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Interrogation Check}} {{Check=[[1d10 + @{cool} + @{Interrogation}]]}}' class='roll-btn'>Interrogation</button></div><div><input type='number' class='skill-input' name='attr_Interrogation'/></div><div><input type='number' class='skill-ip' name='attr_Interrogation_ip'></div><input type='hidden' name='attr_Interrogation_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Persuasion Check}} {{Check=[[1d10 + @{cool} + @{Persuasion}]]}}' class='roll-btn'>Persuasion</button></div><div><input type='number' class='skill-input' name='attr_Persuasion'/></div><div><input type='number' class='skill-ip' name='attr_Persuasion_ip'></div><input type='hidden' name='attr_Persuasion_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Intimidate Check}} {{Check=[[1d10 + @{cool} + @{Intimidate}]]}}' class='roll-btn'>Intimidate</button></div><div><input type='number' class='skill-input' name='attr_Intimidate'/></div><div><input type='number' class='skill-ip' name='attr_Intimidate_ip'></div><input type='hidden' name='attr_Intimidate_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Streetwise Check}} {{Check=[[1d10 + @{cool} + @{Streetwise}]]}}' class='roll-btn'>Streetwise</button></div><div><input type='number' class='skill-input' name='attr_Streetwise'/></div><div><input type='number' class='skill-ip' name='attr_Streetwise_ip'></div><input type='hidden' name='attr_Streetwise_uses'></div>
                </div>
                <div class="skills-table-column">
                    <div class="skill-row header">
                        <div>Skill name</div>
                        <div>Level</div>
                        <div>IP</div>
                    </div>
                    <div class="skill-row" style="font-weight: bold;">TECH</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=BasicTech Check}} {{Check=[[1d10 + @{tech} + @{BasicTech}]]}}' class='roll-btn'>BasicTech</button></div><div><input type='number' class='skill-input' name='attr_BasicTech'/></div><div><input type='number' class='skill-ip' name='attr_BasicTech_ip'></div><input type='hidden' name='attr_BasicTech_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Cybertech Check}} {{Check=[[1d10 + @{tech} + @{Cybertech}]]}}' class='roll-btn'>Cybertech</button></div><div><input type='number' class='skill-input' name='attr_Cybertech'/></div><div><input type='number' class='skill-ip' name='attr_Cybertech_ip'></div><input type='hidden' name='attr_Cybertech_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=FirstAid Check}} {{Check=[[1d10 + @{tech} + @{FirstAid}]]}}' class='roll-btn'>FirstAid</button></div><div><input type='number' class='skill-input' name='attr_FirstAid'/></div><div><input type='number' class='skill-ip' name='attr_FirstAid_ip'></div><input type='hidden' name='attr_FirstAid_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Demolitions Check}} {{Check=[[1d10 + @{tech} + @{Demolitions}]]}}' class='roll-btn'>Demolitions</button></div><div><input type='number' class='skill-input' name='attr_Demolitions'/></div><div><input type='number' class='skill-ip' name='attr_Demolitions_ip'></div><input type='hidden' name='attr_Demolitions_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Disguise Check}} {{Check=[[1d10 + @{tech} + @{Disguise}]]}}' class='roll-btn'>Disguise</button></div><div><input type='number' class='skill-input' name='attr_Disguise'/></div><div><input type='number' class='skill-ip' name='attr_Disguise_ip'></div><input type='hidden' name='attr_Disguise_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Electronics Check}} {{Check=[[1d10 + @{tech} + @{Electronics}]]}}' class='roll-btn'>Electronics</button></div><div><input type='number' class='skill-input' name='attr_Electronics'/></div><div><input type='number' class='skill-ip' name='attr_Electronics_ip'></div><input type='hidden' name='attr_Electronics_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Forgery Check}} {{Check=[[1d10 + @{tech} + @{Forgery}]]}}' class='roll-btn'>Forgery</button></div><div><input type='number' class='skill-input' name='attr_Forgery'/></div><div><input type='number' class='skill-ip' name='attr_Forgery_ip'></div><input type='hidden' name='attr_Forgery_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=PickLock Check}} {{Check=[[1d10 + @{tech} + @{PickLock}]]}}' class='roll-btn'>PickLock</button></div><div><input type='number' class='skill-input' name='attr_PickLock'/></div><div><input type='number' class='skill-ip' name='attr_PickLock_ip'></div><input type='hidden' name='attr_PickLock_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=WeaponsTech Check}} {{Check=[[1d10 + @{tech} + @{WeaponsTech}]]}}' class='roll-btn'>WeaponsTech</button></div><div><input type='number' class='skill-input' name='attr_WeaponsTech'/></div><div><input type='number' class='skill-ip' name='attr_WeaponsTech_ip'></div><input type='hidden' name='attr_WeaponsTech_uses'></div>
                    <div class="skill-row" style="font-weight: bold;">DEX</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Brawling Check}} {{Check=[[1d10 + @{dex} + @{Brawling}]]}}' class='roll-btn'>Brawling</button></div><div><input type='number' class='skill-input' name='attr_Brawling'/></div><div><input type='number' class='skill-ip' name='attr_Brawling_ip'></div><input type='hidden' name='attr_Brawling_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Evasion Check}} {{Check=[[1d10 + @{dex} + @{Evasion}]]}}' class='roll-btn'>Evasion</button></div><div><input type='number' class='skill-input' name='attr_Evasion'/></div><div><input type='number' class='skill-ip' name='attr_Evasion_ip'></div><input type='hidden' name='attr_Evasion_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Melee Weapon Check}} {{Check=[[1d10 + @{dex} + @{Melee Weapon}]]}}' class='roll-btn'>Melee Weapon</button></div><div><input type='number' class='skill-input' name='attr_Melee Weapon'/></div><div><input type='number' class='skill-ip' name='attr_Melee Weapon_ip'></div><input type='hidden' name='attr_Melee Weapon_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Athletics Check}} {{Check=[[1d10 + @{dex} + @{Athletics}]]}}' class='roll-btn'>Athletics</button></div><div><input type='number' class='skill-input' name='attr_Athletics'/></div><div><input type='number' class='skill-ip' name='attr_Athletics_ip'></div><input type='hidden' name='attr_Athletics_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Fencing Check}} {{Check=[[1d10 + @{dex} + @{Fencing}]]}}' class='roll-btn'>Fencing</button></div><div><input type='number' class='skill-input' name='attr_Fencing'/></div><div><input type='number' class='skill-ip' name='attr_Fencing_ip'></div><input type='hidden' name='attr_Fencing_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Stealth Check}} {{Check=[[1d10 + @{dex} + @{Stealth}]]}}' class='roll-btn'>Stealth</button></div><div><input type='number' class='skill-input' name='attr_Stealth'/></div><div><input type='number' class='skill-ip' name='attr_Stealth_ip'></div><input type='hidden' name='attr_Stealth_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Pick Pocket Check}} {{Check=[[1d10 + @{dex} + @{PickPocket}]]}}' class='roll-btn'>PickPocket</button></div><div><input type='number' class='skill-input' name='attr_PickPocket'/></div><div><input type='number' class='skill-ip' name='attr_PickPocket_ip'></div><input type='hidden' name='attr_PickPocket_uses'></div>
                </div>
                <div class="skills-table-column">
                    <div class="skill-row header">
                        <div>Skill name</div>
                        <div>Level</div>
                        <div>IP</div>
                    </div>
                    <div class="skill-row" style="font-weight: bold;">EMP</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Conversation Check}} {{Check=[[1d10 + @{emp} + @{Conversation}]]}}' class='roll-btn'>Conversation</button></div><div><input type='number' class='skill-input' name='attr_Conversation'/></div><div><input type='number' class='skill-ip' name='attr_Conversation_ip'></div><input type='hidden' name='attr_Conversation_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=HumanPerception Check}} {{Check=[[1d10 + @{emp} + @{HumanPerception}]]}}' class='roll-btn'>HumanPerception</button></div><div><input type='number' class='skill-input' name='attr_HumanPerception'/></div><div><input type='number' class='skill-ip' name='attr_HumanPerception_ip'></div><input type='hidden' name='attr_HumanPerception_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=PlayInstrument Check}} {{Check=[[1d10 + @{emp} + @{PlayInstrument}]]}}' class='roll-btn'>PlayInstrument</button></div><div><input type='number' class='skill-input' name='attr_PlayInstrument'/></div><div><input type='number' class='skill-ip' name='attr_PlayInstrument_ip'></div><input type='hidden' name='attr_PlayInstrument_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Interview Check}} {{Check=[[1d10 + @{emp} + @{Interview}]]}}' class='roll-btn'>Interview</button></div><div><input type='number' class='skill-input' name='attr_Interview'/></div><div><input type='number' class='skill-ip' name='attr_Interview_ip'></div><input type='hidden' name='attr_Interview_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Leadership Check}} {{Check=[[1d10 + @{emp} + @{Leadership}]]}}' class='roll-btn'>Leadership</button></div><div><input type='number' class='skill-input' name='attr_Leadership'/></div><div><input type='number' class='skill-ip' name='attr_Leadership_ip'></div><input type='hidden' name='attr_Leadership_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Seduction Check}} {{Check=[[1d10 + @{emp} + @{Seduction}]]}}' class='roll-btn'>Seduction</button></div><div><input type='number' class='skill-input' name='attr_Seduction'/></div><div><input type='number' class='skill-ip' name='attr_Seduction_ip'></div><input type='hidden' name='attr_Seduction_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Social Check}} {{Check=[[1d10 + @{emp} + @{Social}]]}}' class='roll-btn'>Social</button></div><div><input type='number' class='skill-input' name='attr_Social'/></div><div><input type='number' class='skill-ip' name='attr_Social_ip'></div><input type='hidden' name='attr_Social_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Persuasion&Fast Talk Check}} {{Check=[[1d10 + @{emp} + @{PersuasionFastTalk}]]}}' class='roll-btn'>Persuasion&Fast Talk</button></div><div><input type='number' class='skill-input' name='attr_PersuasionFastTalk'/></div><div><input type='number' class='skill-ip' name='attr_PersuasionFastTalk_ip'></div><input type='hidden' name='attr_PersuasionFastTalk_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Perform Check}} {{Check=[[1d10 + @{emp} + @{Perform}]]}}' class='roll-btn'>Perform</button></div><div><input type='number' class='skill-input' name='attr_Perform'/></div><div><input type='number' class='skill-ip' name='attr_Perform_ip'></div><input type='hidden' name='attr_Perform_uses'></div>
                    <div class="skill-row" style="font-weight: bold;">BODY</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Endurance Check}} {{Check=[[1d10 + @{body} + @{Endurance}]]}}' class='roll-btn'>Endurance</button></div><div><input type='number' class='skill-input' name='attr_Endurance'/></div><div><input type='number' class='skill-ip' name='attr_Endurance_ip'></div><input type='hidden' name='attr_Endurance_uses'></div>
                    <div class="skill-row" style="font-weight: bold;">WILL</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Concentration Check}} {{Check=[[1d10 + @{will} + @{Concentration}]]}}' class='roll-btn'>Concentration</button></div><div><input type='number' class='skill-input' name='attr_Concentration'/></div><div><input type='number' class='skill-ip' name='attr_Concentration_ip'></div><input type='hidden' name='attr_Concentration_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Resist Torture/Drugs Check}} {{Check=[[1d10 + @{will} + @{ResistTortureDrugs}]]}}' class='roll-btn'>Resist Torture/Drugs</button></div><div><input type='number' class='skill-input' name='attr_ResistTortureDrugs'/></div><div><input type='number' class='skill-ip' name='attr_ResistTortureDrugs_ip'></div><input type='hidden' name='attr_ResistTortureDrugs_uses'></div>
                    <div class="skill-row" style="font-weight: bold;">REF</div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Marksmanship Check}} {{Check=[[1d10 + @{ref_modified} + @{Marksmanship}]]}}' class='roll-btn'>Marksmanship</button></div><div><input type='number' class='skill-input' name='attr_Marksmanship'/></div><div><input type='number' class='skill-ip' name='attr_Marksmanship_ip'></div><input type='hidden' name='attr_Marksmanship_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Driving Check}} {{Check=[[1d10 + @{ref_modified} + @{Driving}]]}}' class='roll-btn'>Driving</button></div><div><input type='number' class='skill-input' name='attr_Driving'/></div><div><input type='number' class='skill-ip' name='attr_Driving_ip'></div><input type='hidden' name='attr_Driving_uses'></div>
                    <div class='skill-row'><div><button type='roll' value='&{template:default} {{name=Piloting Check}} {{Check=[[1d10 + @{ref_modified} + @{Piloting}]]}}' class='roll-btn'>Piloting</button></div><div><input type='number' class='skill-input' name='attr_Piloting'/></div><div><input type='number' class='skill-ip' name='attr_Piloting_ip'></div><input type='hidden' name='attr_Piloting_uses'></div>
                </div>
            </div>
        </div>
        <div class="tab-content gear-tab">
            <div class="gear section">
                <span>Gear</span>
                <input hidden name="attr_gear_all_mods"/>
                <div class="gear-row">
                    <fieldset class="repeating_gear">
                        <input hidden name="attr_gear_id">
                        <input class="options-flag" type="checkbox" name="attr_options-flag">
                        <div class="display">
                            <input type="text" name="attr_gear_type" placeholder="Type" style="width: 175px;"/>
                            <input type="text" name="attr_gear_mods" placeholder="Mods" style="width: 175px;"/>
                        </div>
                        <div class="options">
                            <input type="number" name="attr_gear_cost" placeholder="$"/>
                            <input type="number" name="attr_gear_weight" placeholder="Wt"/>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="cyber section">
                <span>Cybernetics</span>
                <input hidden name="attr_cyber_all_mods"/>
                <div>
                    <fieldset class="repeating_cyber">
                        <input hidden name="attr_cyber_id">
                        <input class="options-flag" type="checkbox" name="attr_options-flag">
                        <div class="display">
                            <input type="text" name="attr_cyber_type" placeholder="Type" style="width: 175px;"/>
                            <input type="text" name="attr_cyber_mods" placeholder="Mods" style="width: 175px"/>
                        </div>
                        <div class="options">
                            <input type="number" name="attr_cyber_hl" placeholder="HL" style="width: 60px;"/>
                            <input type="number" name="attr_cyber_cost" placeholder="$" style="width: 60px;"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="tab-content life-path-tab">
            <div class="section">
                <textarea name="attr_lifepath">Put your lifepath things here</textarea>
            </div>
        </div>
    </div>
</div>
